---
title: "Example of Statistical Data Analysis"
author: "Wolfgang Petrer"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
bibliography:  RepResRef.bib
vignette: >
  %\VignetteIndexEntry{Example}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)


require(stpvers)
require(flextable)
Projekt("",  "Exampel")
#set_my_options(output="html")
 

 
set_my_options(prozent = list(
 digits = c(0, 0),
 style = 2,
 null_percent_sign = "."
))

vars <- c(
  "o1",  "o2",  "o3",  "o4",  "o5",  "c1",  "c2",  "c3",
  "c4",  "c5",  "e1",  "e2",  "e3",  "e4",  "e5",  "n1",
  "n2",  "n3",  "n4",  "n5",  "a1",  "a2",  "a3",  "a4",  "a5"
)

```







Die von mir verwendeten statistischen Methoden basieren vor allem auf den Empfehlungen von  [@Bortz2006] sowie   [@Sachs2006]. Die Tabellen und Grafiken werden mit der Software R [@R-base] im APA-Style Format [@APA] erstellt.
Das Literaturverzeichnis erstelle ich mit dem
[Literaturgenerator] (https://www.literatur-generator.de/) und dem [Wikipedia](https://irl.github.io/bibwiki/)
BibTeX Generator.


## Big Five personality traits 


Fünf-Faktoren-Modell
Bei den Big Five (auch Fünf-Faktoren-Modell, FFM) handelt es sich um ein Modell der Persönlichkeitspsychologie. Im Englischen wird es auch als OCEAN-Modell bezeichnet (nach den entsprechenden Anfangsbuchstaben Openness, Conscientiousness, Extraversion, Agreeableness, Neuroticism). Entnommen [@wiki:Big_Five]

Ihm zufolge existieren fünf Hauptdimensionen der Persönlichkeit und jeder Mensch lässt sich auf folgenden Skalen einordnen:

 - Offenheit für Erfahrungen (Aufgeschlossenheit),
 - Gewissenhaftigkeit (Perfektionismus),
 - Extraversion (Geselligkeit),
 - Verträglichkeit (Rücksichtnahme, Kooperationsbereitschaft, Empathie) und
 - Neurotizismus (emotionale Labilität und Verletzlichkeit).


```{r DiagrammeR, echo=FALSE}
library(DiagrammeR)

 DiagrammeR("graph RL;

Openness-->personality
Conscientiousness-->personality
Extraversion-->personality
Neuroticism-->personality
Agreeableness-->personality
personality-->Einkommen
Alter-->Einkommen
Geschlecht-->Einkommen
 
 ")
```

 
## Artificial data

```{r, include = FALSE}

n<-100

population.model <- '

Sex =~ sex
Age =~ age
Bildungszertifikat =~ edu
Beruf =~ beruf
Education  ~ 1.04*Bildungszertifikat + 2.76* Beruf
 
single~ 1*age + 2*edu

Openness =~ o1+o2+o3+o4+o5
Conscientiousness =~ c1+c2+c3+c4+c5
Extraversion =~ e1+e2+e3+e4+e5
Neuroticism =~  n1+n2+n3+n4+n5
Agreeableness =~ a1+a2+a3+a4+a5

Einkommen ~ 1.25*Sex +  (-0.31)*Age  + .12*Openness + .23*Conscientiousness + (-0.91)*Extraversion + 2.3*Neuroticism + (-0.541)*Agreeableness

'
 

set.seed(1234)
DF <- lavaan::simulateData(population.model, sample.nobs = n)
scale2<- function(x, mn=1, mx=5){
 
x<-  x-min(x, na.rm=TRUE)
x<-  x/max(x, na.rm=TRUE)
x*(mx -1 )+mn
}
DF<- transform(DF, sex=cut(sex, 2, c("m", "f")),
               age=scale2(age, 18, 55),
               edu=cut(edu,3, c("low", "med", "hig")),
               beruf= cut(edu,2, c("blue", "withe")),
               single =cut(single, 2, c("yes", "no"))
               
               )
DF$Einkommen <- (4-log( DF$Einkommen  - min(DF$Einkommen ) +1 ) )*1000


DF[, -c(1:4, ncol(DF))] <- stp25aggregate::dapply2(DF[, -c(1:4)], 
function(x) {
  if(is.numeric(x)) cut(x, 5, 1:5) else x})


```



## Beschreibung der Untersuchungsgruppe

```{r default-table, results='asis'}
 
which_output()


DF %>% Tabelle2(sex, age, edu, beruf, single, APA = TRUE, caption= "Characteristics")

```


## Untersuchung des Messinstruments

```{r pca-table, results='asis'}

 APA_PCA(DF[vars], 5, cut=.35,include.plot = FALSE)
 

```


```{r rel-table, results='asis'}
 
Openness <- Reliability(~o1+o2+o3+o4+o5, DF, check.keys=TRUE)
Conscientiousness <- Reliability(~ c1+c2+c3+c4+c5, DF, check.keys=TRUE)
Extraversion <- Reliability(~ e1+e2+e3+e4+e5, DF, check.keys=TRUE)
Neuroticism <- Reliability(~  n1+n2+n3+n4+n5, DF, check.keys=TRUE)
Agreeableness <- Reliability(~ a1+a2+a3+a4+a5, DF, check.keys=TRUE)

DF$O<- Openness$index
DF$C<- Conscientiousness$index
DF$E<- Extraversion$index
DF$N<- Neuroticism$index
DF$A<- Agreeableness$index

Alpha2(Openness,Conscientiousness,Extraversion,Neuroticism,Agreeableness)

```



## Test des Regressionsmodels


```{r reg-tab, results='asis'}


DF %>% Tabelle2(Einkommen , sex, age , O , C , E , N , A)
fit<- lm(Einkommen ~ sex + age + O + C + E + N + A, DF)

APA_Table(fit)

```

## Figures



```{r, fig.cap = "Your figure caption.", fig.width=8, fig.height=8}
 
# MySet()
require(effects)
 plot(allEffects(fit), main="")

```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

Vignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The `html_vignette` output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible. The `html_vignette` format:

- Never uses retina figures
- Has a smaller default figure size
- Uses a custom CSS stylesheet instead of the default Twitter Bootstrap style

## Vignette Info

Note the various macros within the `vignette` section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette.

## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css



## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
